{% load static %}
<html>
    <head>
        <title>Farm Dashboard</title>
        <link rel="shortcut icon" href="{% static 'images/logo_t.png' %}" />
        <h2>Plant Details</h2>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
        <script type="text/javascript" src="downloadFile.js"></script>
        <style>
            #tblStocks {
              font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
              border-collapse: collapse;
              width: 100%;
            }
     
            #tblStocks td, #tblStocks th {
              border: 1px solid #ddd;
              padding: 8px;
            }
     
            #tblStocks tr:nth-child(even){background-color: #f2f2f2;}
     
            #tblStocks tr:hover {background-color: #ddd;}
     
            #tblStocks th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: left;
                background-color: #294c67;;
                color: white;
              }
          </style>
    </head>
    <body>
            <table id="tblStocks" cellpadding="0" cellspacing="0">
                <thead>
                    <tr>
                      <th style="background-color: green; color: #fff;">
                        User Name
                      </th>
                      <th style="background-color: green; color: #fff;">
                        Plant Name
                      </th>
                      <th style="background-color: green; color: #fff;">
                        Location
                      </th>
                      <th style="background-color: green; color: #fff;">
                        Number of plants
                      </th>
                      <th style="background-color: green; color: #fff;">
                        Planting Date
                      </th>
                      <th style="background-color: green; color: #fff;">
                          Flowering Date
                      </th>
                      <th style="background-color: green; color: #fff;">
                        Pest Control Date
                      </th>
                      <th style="background-color: green; color: #fff;">
                          Fruiting Date
                      </th>
                      <th style="background-color: green; color: #fff;">
                          Fertilization date
                      </th>
                      <th style="background-color: green; color: #fff;">
                          Harvesting date
                      </th>
                      <th style="background-color: green; color: #fff;">
                          Harvested data
                      </th>
                      
                    </tr>
                  </thead>
                  <tbody>
                    {% for i in var %}
                    <tr style="background-color: rgb(241, 249, 252);">
                      <td>{{i.user}}</td>
                      <td>{{i.plant_name}}</td>
                      <td>{{i.location}}</td>
                      <td>{{i.number}}</td>
                      <td>{{i.planting_date|date:"d-m-Y"}}</td>
                      <td>{{i.flowering_date}}</td>
                      <td>{{i.pest_control_date}}</td>
                      <td>{{i.fruiting_date}}</td>
                      <td>{{i.fertilization_date}}</td>
                      <td>{{i.harvesting_date}}</td>
                      <td>{{i.harvested_data}}</td>
                
                    </tr>
                    {%endfor%}
      
                  </tbody>
                 
            </table>
            <br />
            <button onclick="exportData()">
                <span class="glyphicon glyphicon-download"></span>
                Download list</button>
    </body>
    </html>
    <script>
        function exportData(){
    /* Get the HTML data using Element by Id */
    var table = document.getElementById("tblStocks");
 
    /* Declaring array variable */
    var rows =[];
 
      //iterate through rows of table
    for(var i=0,row; row = table.rows[i];i++){
        //rows would be accessed using the "row" variable assigned in the for loop
        //Get each cell value/column from the row
        column1 = row.cells[0].innerText;
        column2 = row.cells[1].innerText;
        column3 = row.cells[2].innerText;
        column4 = row.cells[3].innerText;
        column5 = row.cells[4].innerText;
        column6 = row.cells[5].innerText;
        column7 = row.cells[6].innerText;
        column8 = row.cells[7].innerText;
        column9 = row.cells[8].innerText;
        column10 = row.cells[9].innerText;
        column11 = row.cells[10].innerText;
 
    /* add a new records in the array */
        rows.push(
            [
                column1,
                column2,
                column3,
                column4,
                column5,
                column6,
                column7,
                column8,
                column9,
                column10,
                column11
            ]
        );
 
        }
        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
        rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Stock_Price_Report.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
        }
    </script>